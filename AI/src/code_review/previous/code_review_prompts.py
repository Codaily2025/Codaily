from langchain_core.prompts import ChatPromptTemplate

feature_inference_prompt = ChatPromptTemplate.from_messages([
    ("system", 
     """
     ë‹¹ì‹ ì€ ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì¡° ë¶„ì„ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤.
     ì•„ëž˜ì— ì£¼ì–´ì§„ ì½”ë“œ ë³€ê²½(diff)ì„ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìžê°€ êµ¬í˜„í•œ ê¸°ëŠ¥ëª…ì„ ìœ ì¶”í•˜ì„¸ìš”.

     ðŸ“Œ ë°˜ë“œì‹œ ì§€ì¼œì•¼ í•  ì¡°ê±´:
     - ê¸°ëŠ¥ì€ ì•„ëž˜ ì œê³µëœ ê¸°ëŠ¥ í›„ë³´ ëª©ë¡(available_features) ì¤‘ì—ì„œë§Œ ê³ ë¥´ì„¸ìš”.
     - ë³µìˆ˜ì˜ ê¸°ëŠ¥ì´ í¬í•¨ë˜ì–´ ìžˆë‹¤ë©´, ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„ëœ í•˜ë‚˜ì˜ ì¤„ë¡œ ê¸°ëŠ¥ëª…ì„ ëª¨ë‘ ë‚˜ì—´í•˜ì„¸ìš”.
     - í›„ë³´ ëª©ë¡ì— ì—†ê±°ë‚˜ ê´€ë ¨ ì—†ëŠ” ë³€ê²½ì€ í¬í•¨í•˜ì§€ ë§ˆì„¸ìš”.
     - ê²°ê³¼ëŠ” ì˜¤ì§ ì•„ëž˜ í˜•ì‹ ì¤‘ í•˜ë‚˜ë¡œë§Œ ì¶œë ¥í•˜ì„¸ìš”:
     - ì—†ë‹¤ë©´ `"ê¸°ëŠ¥ ì—†ìŒ"`ìœ¼ë¡œë§Œ ì‘ë‹µ
     - ì ˆëŒ€ ì„¤ëª…ì´ë‚˜ ì¤„ë°”ê¿ˆ ì—†ì´, ë”± ê·¸ ë¬¸ìž¥ í•˜ë‚˜ë§Œ ì¶œë ¥í•  ê²ƒ

     ðŸ‘‰ "ê¸°ëŠ¥ ì—†ìŒ"
     ðŸ‘‰ "ê¸°ëŠ¥1, ê¸°ëŠ¥2, ê¸°ëŠ¥3"
    
        ðŸ“Œ ì˜ˆì‹œ ì¶œë ¥:
        ë¡œê·¸ì¸ ê¸°ëŠ¥
        íšŒì›ê°€ìž… ê¸°ëŠ¥
        ê¸°ëŠ¥ ì—†ìŒ
        
     """),
    ("human", 
     """
     âœ… ì½”ë“œ ë³€ê²½ ë‚´ìš©:
     {diff_text}

     âœ… ê°€ëŠ¥í•œ ê¸°ëŠ¥ ëª©ë¡:
     {available_features}
     """)
])

checklist_evaluation_prompt = ChatPromptTemplate.from_messages([
    ("system", 
     """
     ë‹¹ì‹ ì€ ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ ê¸°ëŠ¥ êµ¬í˜„ í‰ê°€ìžìž…ë‹ˆë‹¤. ì „ì²´ ì½”ë“œë¥¼ ë¶„ì„í•´ ì•„ëž˜ checklist í•­ëª©ë“¤ì´ êµ¬í˜„ë˜ì–´ ìžˆëŠ”ì§€ íŒë‹¨í•©ë‹ˆë‹¤.
     ê¸°ëŠ¥ êµ¬í˜„ì˜ ê¸°ì¤€ì€ ì•„ëž˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©ë“¤ìž…ë‹ˆë‹¤.
     ê° ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª©ì— ëŒ€í•´ true/falseë¡œ íŒë‹¨í•´ ì£¼ì„¸ìš”.

     - checklist ì™¸ì—ë„ ì¶”ê°€ì ìœ¼ë¡œ êµ¬í˜„ëœ í•­ëª©ì´ ìžˆë‹¤ë©´ extra_implemented ëª©ë¡ì— ì¶”ê°€í•©ë‹ˆë‹¤.
     - ëª¨ë“  checklistê°€ Trueì¼ ê²½ìš° implementsëŠ” True, í•˜ë‚˜ë¼ë„ Falseì´ë©´ Falseìž…ë‹ˆë‹¤.
       ì–´ë–¤ íŒŒì¼ì— êµ¬í˜„ë˜ì—ˆëŠ”ì§€ë„ í•¨ê»˜ ë°˜í™˜í•˜ì„¸ìš”. 

     ðŸ“Œ ì¶œë ¥ì€ ë°˜ë“œì‹œ ì•„ëž˜ JSON í˜•ì‹ì„ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤:

         ì¶œë ¥ í˜•ì‹ ì˜ˆì‹œ:
        {{
          "feature_name": "{featureName}",
          "checklist_evaluation": {{
            "OAuth ì¸ì¦ ìš”ì²­ URL ìƒì„± ë° ë¦¬ë””ë ‰ì…˜ ì²˜ë¦¬": true,
            "ì†Œì…œ í”Œëž«í¼ì—ì„œ ì•¡ì„¸ìŠ¤ í† í° ìˆ˜ì‹  ë° ìœ ì € ì •ë³´ ì¡°íšŒ": false
          }},
          "implements": false,
          "extra_implemented": ["ë¡œê¹… ì²˜ë¦¬", "ì—ëŸ¬ ì‘ë‹µ í†µì¼"],
          "checklist_file_map": {{
            "OAuth ì¸ì¦ ìš”ì²­ URL ìƒì„± ë° ë¦¬ë””ë ‰ì…˜ ì²˜ë¦¬": ["OAuthService.java", "AuthController.java"],
            "ë¡œê¹… ì²˜ë¦¬": ["LogUtil.java", "OAuthService.java"]
          }}
        }}

    âš ï¸ ì£¼ì˜ì‚¬í•­:
    - checklist í•­ëª© ì¤‘ true ë¡œ íŒë‹¨ëœ í•­ëª©ì— ëŒ€í•´ì„œë§Œ checklist_file_map ì— íŒŒì¼ëª…ì„ í¬í•¨í•˜ì„¸ìš”.
    - extra_implemented í•­ëª©ë„ checklist_file_map ì— ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
    - file_pathëŠ” ì •í™•ížˆ ì½”ë“œ ìƒì˜ ì‹¤ì œ íŒŒì¼ëª…ê³¼ ì¼ì¹˜ì‹œì¼œ ì£¼ì„¸ìš”.

     """
    ),
    ("user",
        "ê¸°ëŠ¥ëª…: {featureName}\n"
        "ì „ì²´ ì½”ë“œ:\n{code}\n\n"
        "ì²´í¬ë¦¬ìŠ¤íŠ¸:\n{checklist}")
])


code_review_prompt = ChatPromptTemplate.from_messages([
    ("system", 
        """
        ë‹¹ì‹ ì€ ì „ë¬¸ ì½”ë“œ ë¦¬ë·°ì–´ìž…ë‹ˆë‹¤. ë‹¤ìŒ ì½”ë“œì— ëŒ€í•´ ë‹¤ìŒ 5ê°€ì§€ í•­ëª©ë³„ë¡œ ë¦¬ë·°ë¥¼ ìž‘ì„±í•˜ì„¸ìš”:

        - ì½”ë”© ì»¨ë²¤ì…˜
        - ë²„ê·¸ ìœ„í—˜ë„
        - ë³´ì•ˆ ìœ„í—˜
        - ì„±ëŠ¥ ìµœì í™”
        - ë¦¬íŒ©í† ë§ ì œì•ˆ
        - ìš”ì•½

        ðŸ“Œ ê° í•­ëª©ì€ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ìž‘ì„±í•˜ì„¸ìš”:
        - í•­ëª© ë‚´ì— ë¦¬ë·°í•  ë¶€ë¶„ì´ ìžˆë‹¤ë©´ `items` í•„ë“œë¥¼ ì‚¬ìš©í•´ ì—¬ëŸ¬ í•­ëª©ì„ ë‚˜ì—´í•˜ê³ ,
        - ë¦¬ë·°í•  ë‚´ìš©ì´ ì—†ë‹¤ë©´ `items` ëŒ€ì‹  ë¬¸ìžì—´ `"í•´ë‹¹ ì—†ìŒ"` ì„ ë„£ì–´ì£¼ì„¸ìš”.
        
        í•­ëª©ë³„ ë¦¬ë·°ê°€ ìžˆì„ ê²½ìš°, ê° ë¦¬ë·° í•­ëª©ì—ëŠ” ë‹¤ìŒ í•„ë“œë¥¼ í¬í•¨í•˜ì„¸ìš”:
        - file_path: ë¬¸ì œê°€ ë°œê²¬ëœ íŒŒì¼ ê²½ë¡œ (ì˜ˆ: login.js)
        - line_range: ë¬¸ì œê°€ ìžˆëŠ” ì¤„ ë²”ìœ„ (ì˜ˆ: 30-60 ë˜ëŠ” 42 í•œ ì¤„)
        - severity: ì‹¬ê°ë„ ("ë†’ìŒ", "ì¤‘ê°„", "ë‚®ìŒ" ì¤‘ í•˜ë‚˜)
        - message: í•œ ì¤„ ë¦¬ë·° ë©”ì‹œì§€ (ì¤„ë°”ê¿ˆ ì—†ì´ ìž‘ì„±)

        ðŸ“Œ ë§ˆì§€ë§‰ì—ëŠ” ì „ì²´ ì½”ë“œ ë¦¬ë·°ì— ëŒ€í•œ ì¢…í•©ì ì¸ ì´í‰ì„ `summary` í•„ë“œë¡œ ìž‘ì„±í•˜ì„¸ìš”.  
        ì´ í•„ë“œëŠ” í•œ ì¤„ì¼ í•„ìš”ëŠ” ì—†ìœ¼ë©°, ìžìœ ë¡­ê²Œ ì—¬ëŸ¬ ì¤„ë¡œ ì„œìˆ í•´ë„ ë©ë‹ˆë‹¤.  
        ë‹¤ë§Œ ì¢…ê²°ì–´ë¯¸ëŠ” ëª¨ë‘ `~í•¨` í˜•íƒœë¡œ ìž‘ì„±í•˜ì„¸ìš”. ì˜ˆ: `ì˜¤ë¥˜ê°€ ìžˆìŒ`, `ê°œì„ ì´ í•„ìš”í•¨`
        "~í•´ì•¼ í•¨"ì²˜ëŸ¼ ì´ë¯¸ ì¢…ê²°ì–´ë¯¸ê°€ '~í•¨'ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°ì—ëŠ” ì¤‘ë³µìœ¼ë¡œ '~í•¨'ì„ ë¶™ì´ì§€ ë§ˆì„¸ìš”.

        ðŸ“Œ ì¶œë ¥ì€ ë°˜ë“œì‹œ ë‹¤ìŒ JSON í˜•ì‹ì„ ë”°ë¼ì•¼ í•˜ë©°, í˜•ì‹ì„ ë²—ì–´ë‚˜ì§€ ë§ˆì„¸ìš”:

        {{
          "code_reviews": [
            {{
              "category": "ë³´ì•ˆ ìœ„í—˜",
              "items": [
                {{
                  "filePath": "auth.js",
                  "lineRange": "10-12",
                  "severity": "ë†’ìŒ",
                  "message": "ë¹„ë°€ë²ˆí˜¸ë¥¼ í‰ë¬¸ìœ¼ë¡œ ë¹„êµí•˜ê³  ìžˆìŒ"
                }},
                {{
                  "filePath": "AuthController.java",
                  "lineRange": "10-12",
                  "severity": "ë‚®ìŒ",
                  "message": "ì£¼ì„ ì—†ìŒ"
                }}
              ]
            }},
            {{
              "category": "ì„±ëŠ¥ ìµœì í™”",
              "items": "í•´ë‹¹ ì—†ìŒ"
            }},
            ...
          ],
          "summary": "ì½”ë“œ êµ¬ì¡°ëŠ” ì „ë°˜ì ìœ¼ë¡œ ì–‘í˜¸í•˜ë‚˜ ë³´ì•ˆ ìœ„í—˜ê³¼ ë³µìž¡ë„ ê°œì„ ì´ í•„ìš”í•¨.\nêµ¬í˜„ì€ ì™„ë£Œë˜ì–´ ìžˆìœ¼ë‚˜ í•¨ìˆ˜ ê¸¸ì´ê°€ ë‹¤ì†Œ ê¸¸ê³  ì¤‘ë³µ ì½”ë“œê°€ ì¡´ìž¬í•¨."
        }}

        âš ï¸ ì˜ˆì‹œëŠ” í˜•ì‹ë§Œ ì°¸ê³ í•˜ê³  ë‚´ìš©ì€ ì½”ë“œì— ë§žê²Œ ìƒˆë¡œ ìž‘ì„±í•˜ì„¸ìš”.
        """
    ),
    (
        "user",
        "ê¸°ëŠ¥ëª…: {feature_name}\n"
        "ì „ì²´ ì½”ë“œ:\n{merged_code}"
    )
])

review_summary_prompt = ChatPromptTemplate.from_messages([
    ("system",
    """
    ë‹¹ì‹ ì€ ì½”ë“œ ë¦¬ë·°ë¥¼ ìš”ì•½í•´ì£¼ëŠ” ìš”ì•½ ì „ë¬¸ê°€ìž…ë‹ˆë‹¤.

    ë‹¤ìŒ í”„ë¡œì íŠ¸ì˜ íŠ¹ì • ê¸°ëŠ¥ì— ëŒ€í•´ ìž‘ì„±ëœ ì—¬ëŸ¬ ê°œì˜ ì½”ë“œ ë¦¬ë·°ê°€ ìžˆìŠµë‹ˆë‹¤.  
    ê° ë¦¬ë·°ëŠ” ë²„ê·¸ ìœ„í—˜, ë³´ì•ˆ ìœ„í—˜, ì„±ëŠ¥, ë³µìž¡ë„, ë¦¬íŒ©í† ë§ ì œì•ˆ ë“±ì˜ í•­ëª©ì„ í¬í•¨í•˜ê³  ìžˆìŠµë‹ˆë‹¤.  
    í•­ëª© ë³„ ìš”ì•½í•˜ì—¬ ìž‘ì„±í•´ ì£¼ì„¸ìš”.
    ë˜í•œ, ì´ ê¸°ëŠ¥ êµ¬í˜„ì˜ ì½”ë“œ í’ˆì§ˆì„ ì¢…í•©ì ìœ¼ë¡œ íŒë‹¨í•˜ì—¬ 100ì  ë§Œì  ê¸°ì¤€ìœ¼ë¡œ ì ìˆ˜ë¥¼ ë§¤ê²¨ì£¼ì„¸ìš”.

    ìš”ì•½ì€ ë‹¤ìŒ í˜•ì‹ì„ ë”°ë¥´ì„¸ìš” (ì¤„ë°”ê¿ˆ ì—†ì´ í•œ ë¬¸ìž¥ ìš”ì•½):
        - ìš”ì•½
        - ì ìˆ˜
        - ì½”ë”© ì»¨ë²¤ì…˜
        - ë²„ê·¸ ê°€ëŠ¥ì„±  
        - ë³´ì•ˆ ìœ„í—˜  
        - ì„±ëŠ¥ ìµœì í™”
        - ë¦¬íŒ©í† ë§ ì œì•ˆ    
    
    ê° í•­ëª©ì€ ê°€ëŠ¥í•œ í•œ ì¤„ë¡œ ìž‘ì„±í•˜ë˜, ì–´ë–¤ ê²½ìš°ì—ë„ ì¤„ë°”ê¿ˆ ì—†ì´ `- í•­ëª©:` ë’¤ì— í•œ ì¤„ë¡œ ì´ì–´ì§€ê²Œ ìž‘ì„±í•´ ì£¼ì„¸ìš”.  
    ðŸ“Œ ì•„ëž˜ëŠ” í˜•ì‹ ì°¸ê³ ìš© ì˜ˆì‹œì´ë©°, ë‚´ìš©ì€ ì ˆëŒ€ ì°¸ê³ í•˜ì§€ ë§ê³  ì½”ë“œì— ë§žê²Œ ìƒˆë¡œ ìž‘ì„±í•´ ì£¼ì„¸ìš”.

        [ì˜ˆì‹œ í˜•ì‹ â€” ë‚´ìš©ì€ ì°¸ê³ í•˜ì§€ ë§ˆì„¸ìš”]
        - ìš”ì•½: ...
        - ì ìˆ˜: 00
        - ì½”ë”© ì»¨ë²¤ì…˜: ...
        - ë²„ê·¸ ê°€ëŠ¥ì„±: ...
        - ë³´ì•ˆ ìœ„í—˜: ...
        - ì„±ëŠ¥ ìµœì í™”: ...
        - ë¦¬íŒ©í† ë§ ì œì•ˆ: ...


    ë˜í•œ ë¬¸ì„œì˜ ì¢…ê²°ì–´ë¯¸ëŠ” ëª¨ë‘ '~í•¨' í˜•íƒœë¡œ ë°”ê¿” ì£¼ì„¸ìš”.
    "~í•´ì•¼ í•¨"ì²˜ëŸ¼ ì´ë¯¸ ì¢…ê²°ì–´ë¯¸ê°€ '~ã…'ìœ¼ë¡œ ëë‚˜ëŠ” ê²½ìš°ì—ëŠ” ì¤‘ë³µìœ¼ë¡œ '~í•¨'ì„ ë¶™ì´ì§€ ë§ˆì„¸ìš”.
        
        ì˜ˆì‹œ:
        - 'í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤' â†’ 'í™•ì¸í•¨'  
        - 'ê°€ëŠ¥í•˜ë‹¤' â†’ 'ê°€ëŠ¥í•¨'  
        - 'ì˜¤ë¥˜ê°€ ìžˆë‹¤' â†’ 'ì˜¤ë¥˜ê°€ ìžˆìŒ'
        - 'í•´ì•¼ í•¨' -> 'í•´ì•¼ í•¨'
        - 'ë‚®ìŒ' -> 'ë‚®ìŒ'
        - 'ë³´ìž„' -> 'ë³´ìž„'


    """ 
    ),
    
    ("user", 
    """
    ì¹´í…Œê³ ë¦¬ë³„ í•­ëª©:
    {categorized_reviews}
    """)
])